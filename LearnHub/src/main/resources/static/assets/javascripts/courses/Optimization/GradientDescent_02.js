import{n as c}from"../assets/math-vsX8GA3L.js";import{d as I}from"../assets/draw-NCLF76eS.js";import{w as L,n as S,S as M}from"./GradientDescent_noise_adapter.js";import"../assets/_commonjsHelpers-C4iS2aBk.js";const z="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let R=(e=21)=>{let n="",s=crypto.getRandomValues(new Uint8Array(e));for(;e--;)n+=z[s[e]&63];return n};function P(e){return new Worker("/assets/javascripts/courses/assets/GradientDescent_02.worker-DId5HhBp.js",{name:e==null?void 0:e.name})}function $(e,n,s){return{noise:S(s),map:void 0,attempts:[],x:Math.random(),y:Math.random(),result:null,particles:[]}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("mana-descent"),n=e.getContext("2d"),s=document.getElementById("confirm"),x=document.getElementById("restart");let u=new P,w=()=>{},t=null,h=!1,f=null;function B(i,r,l){let a=!1;return w(),w=()=>a=!1,u.postMessage({width:i,height:r,seed:l}),new Promise(o=>u.addEventListener("message",function g(p){try{if(a)return;const d=document.createElement("canvas"),y=d.getContext("2d");d.width=i,d.height=r,y.putImageData(p.data,0,0),o(d)}finally{u.removeEventListener("message",g)}}))}function v(i,r){t.result||(t.x=i/e.width,t.y=r/e.height,m())}function C(){if(t.attempts.length==10){t.result=[t.x,t.y,t.noise(t.x,t.y)()],s.disabled=!0;return}const i=t.noise(t.x,t.y),r=i(),l=i(1,0),a=i(0,1);t.attempts.push([t.x,t.y,r,l,a]);for(let o=0;o<16;o++)t.particles.push({life:3+c()/3,time:0,x:t.x,y:t.y,vy:c()/400,vx:c()/400,ax:(-l+c()*2/3)/200,ay:(-a+c()*2/3)/200,z:r});s.textContent=t.attempts.length==10?"여기로 결정":`${t.attempts.length+1}개째 터뜨리기`,m()}function b(){const i=R();t=$(e.width,e.height,i),B(e.width,e.height,i).then(r=>{t.map=r,m()}),s.textContent="1개째 터뜨리기",s.disabled=!1,m()}function m(){h=!0}requestAnimationFrame(function i(r){const l=f===null?0:(r-f)/1e3;if(f=r,h){h=t.particles.length!=0,n.clearRect(0,0,e.width,e.height),t.result&&(n.globalAlpha=.3,t.map?n.drawImage(t.map,0,0):(n.fillStyle="black",n.font="24px Arial",n.textAlign="center",n.textBaseline="bottom",n.textBaseline="top",n.fillText("그래프 그리는 중",e.width/2,e.height/2-16),n.font="16px Arial",n.fillText("잠시만 기다려 주세요.",e.width/2,e.height/2+16)),n.globalAlpha=1),t.particles=t.particles.filter(a=>(a.time+=l)<a.life);for(const a of t.particles){const o=Math.floor(256*L(a.z));a.x+=l*(a.vx+=l*a.ax),a.y+=l*(a.vy+=l*a.ay),n.fillStyle=`rgba(${o}, 0, ${255-o}, ${1-a.time/a.life})`,n.fillRect(Math.round(e.width*a.x)-2,Math.round(e.height*a.y)-2,4,4)}n.lineWidth=2;for(let a=0;a<t.attempts.length;a++){const[o,g,p,d,y]=t.attempts[a],A=Math.floor(256*L(p)),E=e.width*o,k=e.height*g;n.globalAlpha=t.result||a==t.attempts.length-1?1:.5,n.fillStyle=n.strokeStyle=`rgba(${A}, 0, ${255-A})`,I(n,E,k,E-10/M*d,k-10/M*y,10)}n.globalAlpha=1,n.strokeStyle="black",n.beginPath(),n.arc(e.width*t.x,e.height*t.y,8,0,2*Math.PI),n.stroke()}requestAnimationFrame(i)}),e.addEventListener("mousedown",i=>{if(!(i.buttons&1))return;const{left:r,top:l}=i.target.getBoundingClientRect();v(i.clientX-r,i.clientY-l)}),e.addEventListener("mousemove",i=>{if(!(i.buttons&1))return;const{left:r,top:l}=i.target.getBoundingClientRect();v(i.clientX-r,i.clientY-l)}),s.addEventListener("click",C),x.addEventListener("click",b),b()});

import{T as At,j as xe,k as nt,L as vt,l as te,m as st,n as j,o as N,p as yt,q as xt,D as Tt,d as Z,r as ie,s as M,V as it,M as ue,t as X,I as Et,u as wt,a as rt,v as St,w as Ct,x as _e,y as Rt,z as ot,E as at,G as Te,H as Lt,J as me,K as Ot,i as ct,N as kt,Q as Nt,f as Mt,U as It,e as Ft,X as Dt,Y as Ht,Z as Pt,_ as Bt,$ as ge,P as Gt,a0 as Ut,a1 as Vt,a2 as jt,a3 as Kt,a4 as zt,a5 as lt,a6 as Fe,a7 as ut,a8 as Xt,a9 as $t,aa as Wt,ab as Yt,ac as qt,ad as Qt,ae as Jt,F as Zt,af as en,ag as De,ah as He,ai as Pe,aj as Be,ak as tn,al as nn,am as sn}from"./OrbitControls-uNc7TxmE.js";function rn(r){if(r&&!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=r,document.head.appendChild(e),r}}function $(r,e){var t=r.__state.conversionName.toString(),s=Math.round(r.r),n=Math.round(r.g),i=Math.round(r.b),o=r.a,a=Math.round(r.h),c=r.s.toFixed(1),l=r.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var d=r.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}else{if(t==="CSS_RGB")return"rgb("+s+","+n+","+i+")";if(t==="CSS_RGBA")return"rgba("+s+","+n+","+i+","+o+")";if(t==="HEX")return"0x"+r.hex.toString(16);if(t==="RGB_ARRAY")return"["+s+","+n+","+i+"]";if(t==="RGBA_ARRAY")return"["+s+","+n+","+i+","+o+"]";if(t==="RGB_OBJ")return"{r:"+s+",g:"+n+",b:"+i+"}";if(t==="RGBA_OBJ")return"{r:"+s+",g:"+n+",b:"+i+",a:"+o+"}";if(t==="HSV_OBJ")return"{h:"+a+",s:"+c+",v:"+l+"}";if(t==="HSVA_OBJ")return"{h:"+a+",s:"+c+",v:"+l+",a:"+o+"}"}return"unknown format"}var Ge=Array.prototype.forEach,q=Array.prototype.slice,p={BREAK:{},extend:function(e){return this.each(q.call(arguments,1),function(t){var s=this.isObject(t)?Object.keys(t):[];s.forEach((function(n){this.isUndefined(t[n])||(e[n]=t[n])}).bind(this))},this),e},defaults:function(e){return this.each(q.call(arguments,1),function(t){var s=this.isObject(t)?Object.keys(t):[];s.forEach((function(n){this.isUndefined(e[n])&&(e[n]=t[n])}).bind(this))},this),e},compose:function(){var e=q.call(arguments);return function(){for(var t=q.call(arguments),s=e.length-1;s>=0;s--)t=[e[s].apply(this,t)];return t[0]}},each:function(e,t,s){if(e){if(Ge&&e.forEach&&e.forEach===Ge)e.forEach(t,s);else if(e.length===e.length+0){var n=void 0,i=void 0;for(n=0,i=e.length;n<i;n++)if(n in e&&t.call(s,e[n],n)===this.BREAK)return}else for(var o in e)if(t.call(s,e[o],o)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,t,s){var n=void 0;return function(){var i=this,o=arguments;function a(){n=null,s||e.apply(i,o)}var c=s||!n;clearTimeout(n),n=setTimeout(a,t),c&&e.apply(i,o)}},toArray:function(e){return e.toArray?e.toArray():q.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(r){function e(t){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}(function(r){return isNaN(r)}),isArray:Array.isArray||function(r){return r.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},on=[{litmus:p.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:$},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:$},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:$},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:$}}},{litmus:p.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:p.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:p.isObject,conversions:{RGBA_OBJ:{read:function(e){return p.isNumber(e.r)&&p.isNumber(e.g)&&p.isNumber(e.b)&&p.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return p.isNumber(e.r)&&p.isNumber(e.g)&&p.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return p.isNumber(e.h)&&p.isNumber(e.s)&&p.isNumber(e.v)&&p.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return p.isNumber(e.h)&&p.isNumber(e.s)&&p.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Q=void 0,ce=void 0,de=function(){ce=!1;var e=arguments.length>1?p.toArray(arguments):arguments[0];return p.each(on,function(t){if(t.litmus(e))return p.each(t.conversions,function(s,n){if(Q=s.read(e),ce===!1&&Q!==!1)return ce=Q,Q.conversionName=n,Q.conversion=s,p.BREAK}),p.BREAK}),ce},Ue=void 0,re={hsv_to_rgb:function(e,t,s){var n=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),o=s*(1-t),a=s*(1-i*t),c=s*(1-(1-i)*t),l=[[s,c,o],[a,s,o],[o,s,c],[o,a,s],[c,o,s],[s,o,a]][n];return{r:l[0]*255,g:l[1]*255,b:l[2]*255}},rgb_to_hsv:function(e,t,s){var n=Math.min(e,t,s),i=Math.max(e,t,s),o=i-n,a=void 0,c=void 0;if(i!==0)c=o/i;else return{h:NaN,s:0,v:0};return e===i?a=(t-s)/o:t===i?a=2+(s-e)/o:a=4+(e-t)/o,a/=6,a<0&&(a+=1),{h:a*360,s:c,v:i/255}},rgb_to_hex:function(e,t,s){var n=this.hex_with_component(0,2,e);return n=this.hex_with_component(n,1,t),n=this.hex_with_component(n,0,s),n},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(e,t,s){return s<<(Ue=t*8)|e&~(255<<Ue)}},an=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},L=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")},O=function(){function r(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,s){return t&&r(e.prototype,t),s&&r(e,s),e}}(),P=function r(e,t,s){e===null&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(n===void 0){var i=Object.getPrototypeOf(e);return i===null?void 0:r(i,t,s)}else{if("value"in n)return n.value;var o=n.get;return o===void 0?void 0:o.call(s)}},B=function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(r,e):r.__proto__=e)},G=function(r,e){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:r},w=function(){function r(){if(L(this,r),this.__state=de.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return O(r,[{key:"toString",value:function(){return $(this)}},{key:"toHexString",value:function(){return $(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),r}();function Le(r,e,t){Object.defineProperty(r,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(w.recalculateRGB(this,e,t),this.__state[e])},set:function(n){this.__state.space!=="RGB"&&(w.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=n}})}function Oe(r,e){Object.defineProperty(r,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(w.recalculateHSV(this),this.__state[e])},set:function(s){this.__state.space!=="HSV"&&(w.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=s}})}w.recalculateRGB=function(r,e,t){if(r.__state.space==="HEX")r.__state[e]=re.component_from_hex(r.__state.hex,t);else if(r.__state.space==="HSV")p.extend(r.__state,re.hsv_to_rgb(r.__state.h,r.__state.s,r.__state.v));else throw new Error("Corrupted color state")};w.recalculateHSV=function(r){var e=re.rgb_to_hsv(r.r,r.g,r.b);p.extend(r.__state,{s:e.s,v:e.v}),p.isNaN(e.h)?p.isUndefined(r.__state.h)&&(r.__state.h=0):r.__state.h=e.h};w.COMPONENTS=["r","g","b","h","s","v","hex","a"];Le(w.prototype,"r",2);Le(w.prototype,"g",1);Le(w.prototype,"b",0);Oe(w.prototype,"h");Oe(w.prototype,"s");Oe(w.prototype,"v");Object.defineProperty(w.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(w.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=re.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var U=function(){function r(e,t){L(this,r),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return O(r,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),r}(),cn={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},dt={};p.each(cn,function(r,e){p.each(r,function(t){dt[t]=e})});var ln=/(\d+(\.\d+)?)px/;function k(r){if(r==="0"||p.isUndefined(r))return 0;var e=r.match(ln);return p.isNull(e)?0:parseFloat(e[1])}var f={makeSelectable:function(e,t){e===void 0||e.style===void 0||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,s){var n=s,i=t;p.isUndefined(i)&&(i=!0),p.isUndefined(n)&&(n=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,s,n){var i=s||{},o=dt[t];if(!o)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(o);switch(o){case"MouseEvents":{var c=i.x||i.clientX||0,l=i.y||i.clientY||0;a.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,c,l,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var d=a.initKeyboardEvent||a.initKeyEvent;p.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),d(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break}default:{a.initEvent(t,i.bubbles||!1,i.cancelable||!0);break}}p.defaults(a,n),e.dispatchEvent(a)},bind:function(e,t,s,n){var i=n||!1;return e.addEventListener?e.addEventListener(t,s,i):e.attachEvent&&e.attachEvent("on"+t,s),f},unbind:function(e,t,s,n){var i=n||!1;return e.removeEventListener?e.removeEventListener(t,s,i):e.detachEvent&&e.detachEvent("on"+t,s),f},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var s=e.className.split(/ +/);s.indexOf(t)===-1&&(s.push(t),e.className=s.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return f},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var s=e.className.split(/ +/),n=s.indexOf(t);n!==-1&&(s.splice(n,1),e.className=s.join(" "))}else e.className=void 0;return f},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return k(t["border-left-width"])+k(t["border-right-width"])+k(t["padding-left"])+k(t["padding-right"])+k(t.width)},getHeight:function(e){var t=getComputedStyle(e);return k(t["border-top-width"])+k(t["border-bottom-width"])+k(t["padding-top"])+k(t["padding-bottom"])+k(t.height)},getOffset:function(e){var t=e,s={left:0,top:0};if(t.offsetParent)do s.left+=t.offsetLeft,s.top+=t.offsetTop,t=t.offsetParent;while(t);return s},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},ke=function(r){B(e,r);function e(t,s){L(this,e);var n=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s)),i=n;n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox");function o(){i.setValue(!i.__prev)}return f.bind(n.__checkbox,"change",o,!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return O(e,[{key:"setValue",value:function(s){var n=P(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,s);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),P(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(U),ft=function(r){B(e,r);function e(t,s,n){L(this,e);var i=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s)),o=n,a=i;if(i.__select=document.createElement("select"),p.isArray(o)){var c={};p.each(o,function(l){c[l]=l}),o=c}return p.each(o,function(l,d){var u=document.createElement("option");u.innerHTML=d,u.setAttribute("value",l),a.__select.appendChild(u)}),i.updateDisplay(),f.bind(i.__select,"change",function(){var l=this.options[this.selectedIndex].value;a.setValue(l)}),i.domElement.appendChild(i.__select),i}return O(e,[{key:"setValue",value:function(s){var n=P(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,s);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return f.isActive(this.__select)?this:(this.__select.value=this.getValue(),P(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(U),ht=function(r){B(e,r);function e(t,s){L(this,e);var n=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s)),i=n;function o(){i.setValue(i.__input.value)}function a(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),f.bind(n.__input,"keyup",o),f.bind(n.__input,"change",o),f.bind(n.__input,"blur",a),f.bind(n.__input,"keydown",function(c){c.keyCode===13&&this.blur()}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return O(e,[{key:"updateDisplay",value:function(){return f.isActive(this.__input)||(this.__input.value=this.getValue()),P(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(U);function Ve(r){var e=r.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var Ne=function(r){B(e,r);function e(t,s,n){L(this,e);var i=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s)),o=n||{};return i.__min=o.min,i.__max=o.max,i.__step=o.step,p.isUndefined(i.__step)?i.initialValue===0?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=Ve(i.__impliedStep),i}return O(e,[{key:"setValue",value:function(s){var n=s;return this.__min!==void 0&&n<this.__min?n=this.__min:this.__max!==void 0&&n>this.__max&&(n=this.__max),this.__step!==void 0&&n%this.__step!==0&&(n=Math.round(n/this.__step)*this.__step),P(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(s){return this.__min=s,this}},{key:"max",value:function(s){return this.__max=s,this}},{key:"step",value:function(s){return this.__step=s,this.__impliedStep=s,this.__precision=Ve(s),this}}]),e}(U);function un(r,e){var t=Math.pow(10,e);return Math.round(r*t)/t}var oe=function(r){B(e,r);function e(t,s,n){L(this,e);var i=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s,n));i.__truncationSuspended=!1;var o=i,a=void 0;function c(){var g=parseFloat(o.__input.value);p.isNaN(g)||o.setValue(g)}function l(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function d(){l()}function u(g){var m=a-g.clientY;o.setValue(o.getValue()+m*o.__impliedStep),a=g.clientY}function h(){f.unbind(window,"mousemove",u),f.unbind(window,"mouseup",h),l()}function _(g){f.bind(window,"mousemove",u),f.bind(window,"mouseup",h),a=g.clientY}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),f.bind(i.__input,"change",c),f.bind(i.__input,"blur",d),f.bind(i.__input,"mousedown",_),f.bind(i.__input,"keydown",function(g){g.keyCode===13&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,l())}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return O(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():un(this.getValue(),this.__precision),P(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Ne);function je(r,e,t,s,n){return s+(n-s)*((r-e)/(t-e))}var fe=function(r){B(e,r);function e(t,s,n,i,o){L(this,e);var a=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s,{min:n,max:i,step:o})),c=a;a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),f.bind(a.__background,"mousedown",l),f.bind(a.__background,"touchstart",h),f.addClass(a.__background,"slider"),f.addClass(a.__foreground,"slider-fg");function l(m){document.activeElement.blur(),f.bind(window,"mousemove",d),f.bind(window,"mouseup",u),d(m)}function d(m){m.preventDefault();var b=c.__background.getBoundingClientRect();return c.setValue(je(m.clientX,b.left,b.right,c.__min,c.__max)),!1}function u(){f.unbind(window,"mousemove",d),f.unbind(window,"mouseup",u),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function h(m){m.touches.length===1&&(f.bind(window,"touchmove",_),f.bind(window,"touchend",g),_(m))}function _(m){var b=m.touches[0].clientX,A=c.__background.getBoundingClientRect();c.setValue(je(b,A.left,A.right,c.__min,c.__max))}function g(){f.unbind(window,"touchmove",_),f.unbind(window,"touchend",g),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}return a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return O(e,[{key:"updateDisplay",value:function(){var s=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=s*100+"%",P(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Ne),Me=function(r){B(e,r);function e(t,s,n){L(this,e);var i=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s)),o=i;return i.__button=document.createElement("div"),i.__button.innerHTML=n===void 0?"Fire":n,f.bind(i.__button,"click",function(a){return a.preventDefault(),o.fire(),!1}),f.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return O(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(U),he=function(r){B(e,r);function e(t,s){L(this,e);var n=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,s));n.__color=new w(n.getValue()),n.__temp=new w(0);var i=n;n.domElement=document.createElement("div"),f.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",f.bind(n.__input,"keydown",function(m){m.keyCode===13&&u.call(this)}),f.bind(n.__input,"blur",u),f.bind(n.__selector,"mousedown",function(){f.addClass(this,"drag").bind(window,"mouseup",function(){f.removeClass(i.__selector,"drag")})}),f.bind(n.__selector,"touchstart",function(){f.addClass(this,"drag").bind(window,"touchend",function(){f.removeClass(i.__selector,"drag")})});var o=document.createElement("div");p.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),p.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),p.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),p.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),p.extend(o.style,{width:"100%",height:"100%",background:"none"}),Ke(o,"top","rgba(0,0,0,0)","#000"),p.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),fn(n.__hue_field),p.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),f.bind(n.__saturation_field,"mousedown",a),f.bind(n.__saturation_field,"touchstart",a),f.bind(n.__field_knob,"mousedown",a),f.bind(n.__field_knob,"touchstart",a),f.bind(n.__hue_field,"mousedown",c),f.bind(n.__hue_field,"touchstart",c);function a(m){_(m),f.bind(window,"mousemove",_),f.bind(window,"touchmove",_),f.bind(window,"mouseup",l),f.bind(window,"touchend",l)}function c(m){g(m),f.bind(window,"mousemove",g),f.bind(window,"touchmove",g),f.bind(window,"mouseup",d),f.bind(window,"touchend",d)}function l(){f.unbind(window,"mousemove",_),f.unbind(window,"touchmove",_),f.unbind(window,"mouseup",l),f.unbind(window,"touchend",l),h()}function d(){f.unbind(window,"mousemove",g),f.unbind(window,"touchmove",g),f.unbind(window,"mouseup",d),f.unbind(window,"touchend",d),h()}function u(){var m=de(this.value);m!==!1?(i.__color.__state=m,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function h(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}n.__saturation_field.appendChild(o),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay();function _(m){m.type.indexOf("touch")===-1&&m.preventDefault();var b=i.__saturation_field.getBoundingClientRect(),A=m.touches&&m.touches[0]||m,x=A.clientX,E=A.clientY,y=(x-b.left)/(b.right-b.left),S=1-(E-b.top)/(b.bottom-b.top);return S>1?S=1:S<0&&(S=0),y>1?y=1:y<0&&(y=0),i.__color.v=S,i.__color.s=y,i.setValue(i.__color.toOriginal()),!1}function g(m){m.type.indexOf("touch")===-1&&m.preventDefault();var b=i.__hue_field.getBoundingClientRect(),A=m.touches&&m.touches[0]||m,x=A.clientY,E=1-(x-b.top)/(b.bottom-b.top);return E>1?E=1:E<0&&(E=0),i.__color.h=E*360,i.setValue(i.__color.toOriginal()),!1}return n}return O(e,[{key:"updateDisplay",value:function(){var s=de(this.getValue());if(s!==!1){var n=!1;p.each(w.COMPONENTS,function(a){if(!p.isUndefined(s[a])&&!p.isUndefined(this.__color.__state[a])&&s[a]!==this.__color.__state[a])return n=!0,{}},this),n&&p.extend(this.__color.__state,s)}p.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,o=255-i;p.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,Ke(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),p.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),e}(U),dn=["-moz-","-o-","-webkit-","-ms-",""];function Ke(r,e,t,s){r.style.background="",p.each(dn,function(n){r.style.cssText+="background: "+n+"linear-gradient("+e+", "+t+" 0%, "+s+" 100%); "})}function fn(r){r.style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var hn={load:function(e,t){var s=t||document,n=s.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,s.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){var s=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var i=s.getElementsByTagName("head")[0];try{i.appendChild(n)}catch{}}},pn=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,_n=function(e,t){var s=e[t];return p.isArray(arguments[2])||p.isObject(arguments[2])?new ft(e,t,arguments[2]):p.isNumber(s)?p.isNumber(arguments[2])&&p.isNumber(arguments[3])?p.isNumber(arguments[4])?new fe(e,t,arguments[2],arguments[3],arguments[4]):new fe(e,t,arguments[2],arguments[3]):p.isNumber(arguments[4])?new oe(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new oe(e,t,{min:arguments[2],max:arguments[3]}):p.isString(s)?new ht(e,t):p.isFunction(s)?new Me(e,t,""):p.isBoolean(s)?new ke(e,t):null};function mn(r){setTimeout(r,1e3/60)}var gn=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||mn,bn=function(){function r(){L(this,r),this.backgroundElement=document.createElement("div"),p.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),f.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),p.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;f.bind(this.backgroundElement,"click",function(){e.hide()})}return O(r,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),p.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,s=function n(){t.domElement.style.display="none",t.backgroundElement.style.display="none",f.unbind(t.domElement,"webkitTransitionEnd",n),f.unbind(t.domElement,"transitionend",n),f.unbind(t.domElement,"oTransitionEnd",n)};f.bind(this.domElement,"webkitTransitionEnd",s),f.bind(this.domElement,"transitionend",s),f.bind(this.domElement,"oTransitionEnd",s),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-f.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-f.getHeight(this.domElement)/2+"px"}}]),r}(),An=rn(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);hn.inject(An);var ze="dg",Xe=72,$e=20,ae="Default",ee=function(){try{return!!window.localStorage}catch{return!1}}(),ne=void 0,We=!0,K=void 0,be=!1,pt=[],T=function r(e){var t=this,s=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),f.addClass(this.domElement,ze),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],s=p.defaults(s,{closeOnTop:!1,autoPlace:!0,width:r.DEFAULT_WIDTH}),s=p.defaults(s,{resizable:s.autoPlace,hideable:s.autoPlace}),p.isUndefined(s.load)?s.load={preset:ae}:s.preset&&(s.load.preset=s.preset),p.isUndefined(s.parent)&&s.hideable&&pt.push(this),s.resizable=p.isUndefined(s.parent)&&s.resizable,s.autoPlace&&p.isUndefined(s.scrollable)&&(s.scrollable=!0);var n=ee&&localStorage.getItem(z(this,"isLocal"))==="true",i=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return s.parent}},scrollable:{get:function(){return s.scrollable}},autoPlace:{get:function(){return s.autoPlace}},closeOnTop:{get:function(){return s.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:s.load.preset},set:function(h){t.parent?t.getRoot().preset=h:s.load.preset=h,Tn(this),t.revert()}},width:{get:function(){return s.width},set:function(h){s.width=h,Se(t,h)}},name:{get:function(){return s.name},set:function(h){s.name=h,o&&(o.innerHTML=s.name)}},closed:{get:function(){return s.closed},set:function(h){s.closed=h,s.closed?f.addClass(t.__ul,r.CLASS_CLOSED):f.removeClass(t.__ul,r.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=h?r.TEXT_OPEN:r.TEXT_CLOSED)}},load:{get:function(){return s.load}},useLocalStorage:{get:function(){return n},set:function(h){ee&&(n=h,h?f.bind(window,"unload",i):f.unbind(window,"unload",i),localStorage.setItem(z(t,"isLocal"),h))}}}),p.isUndefined(s.parent)){if(this.closed=s.closed||!1,f.addClass(this.domElement,r.CLASS_MAIN),f.makeSelectable(this.domElement,!1),ee&&n){t.useLocalStorage=!0;var a=localStorage.getItem(z(this,"gui"));a&&(s.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=r.TEXT_CLOSED,f.addClass(this.__closeButton,r.CLASS_CLOSE_BUTTON),s.closeOnTop?(f.addClass(this.__closeButton,r.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(f.addClass(this.__closeButton,r.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),f.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{s.closed===void 0&&(s.closed=!0);var c=document.createTextNode(s.name);f.addClass(c,"controller-name"),o=Ie(t,c);var l=function(h){return h.preventDefault(),t.closed=!t.closed,!1};f.addClass(this.__ul,r.CLASS_CLOSED),f.addClass(o,"title"),f.bind(o,"click",l),s.closed||(this.closed=!1)}s.autoPlace&&(p.isUndefined(s.parent)&&(We&&(K=document.createElement("div"),f.addClass(K,ze),f.addClass(K,r.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(K),We=!1),K.appendChild(this.domElement),f.addClass(this.domElement,r.CLASS_AUTO_PLACE)),this.parent||Se(t,s.width)),this.__resizeHandler=function(){t.onResizeDebounced()},f.bind(window,"resize",this.__resizeHandler),f.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),f.bind(this.__ul,"transitionend",this.__resizeHandler),f.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),s.resizable&&xn(this),i=function(){ee&&localStorage.getItem(z(t,"isLocal"))==="true"&&localStorage.setItem(z(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=i;function d(){var u=t.getRoot();u.width+=1,p.defer(function(){u.width-=1})}s.parent||d()};T.toggleHide=function(){be=!be,p.each(pt,function(r){r.domElement.style.display=be?"none":""})};T.CLASS_AUTO_PLACE="a";T.CLASS_AUTO_PLACE_CONTAINER="ac";T.CLASS_MAIN="main";T.CLASS_CONTROLLER_ROW="cr";T.CLASS_TOO_TALL="taller-than-window";T.CLASS_CLOSED="closed";T.CLASS_CLOSE_BUTTON="close-button";T.CLASS_CLOSE_TOP="close-top";T.CLASS_CLOSE_BOTTOM="close-bottom";T.CLASS_DRAG="drag";T.DEFAULT_WIDTH=245;T.TEXT_CLOSED="Close Controls";T.TEXT_OPEN="Open Controls";T._keydownHandler=function(r){document.activeElement.type!=="text"&&(r.which===Xe||r.keyCode===Xe)&&T.toggleHide()};f.bind(window,"keydown",T._keydownHandler,!1);p.extend(T.prototype,{add:function(e,t){return se(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return se(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;p.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&K.removeChild(this.domElement);var e=this;p.each(this.__folders,function(t){e.removeFolder(t)}),f.unbind(window,"keydown",T._keydownHandler,!1),Ye(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var s=new T(t);this.__folders[e]=s;var n=Ie(this,s.domElement);return f.addClass(n,"folder"),s},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],Ye(e);var t=this;p.each(e.__folders,function(s){e.removeFolder(s)}),p.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=f.getOffset(e.__ul).top,s=0;p.each(e.__ul.childNodes,function(n){e.autoPlace&&n===e.__save_row||(s+=f.getHeight(n))}),window.innerHeight-t-$e<s?(f.addClass(e.domElement,T.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-$e+"px"):(f.removeClass(e.domElement,T.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&p.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:p.debounce(function(){this.onResize()},50),remember:function(){if(p.isUndefined(ne)&&(ne=new bn,ne.domElement.innerHTML=pn),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;p.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length===0&&yn(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&Se(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=le(this)),e.folders={},p.each(this.__folders,function(t,s){e.folders[s]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=le(this),Ee(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[ae]=le(this,!0)),this.load.remembered[e]=le(this),this.preset=e,we(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){p.each(this.__controllers,function(t){this.getRoot().load.remembered?_t(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),p.each(this.__folders,function(t){t.revert(t)}),e||Ee(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length===0;this.__listening.push(e),t&&mt(this.__listening)},updateDisplay:function(){p.each(this.__controllers,function(e){e.updateDisplay()}),p.each(this.__folders,function(e){e.updateDisplay()})}});function Ie(r,e,t){var s=document.createElement("li");return e&&s.appendChild(e),t?r.__ul.insertBefore(s,t):r.__ul.appendChild(s),r.onResize(),s}function Ye(r){f.unbind(window,"resize",r.__resizeHandler),r.saveToLocalStorageIfPossible&&f.unbind(window,"unload",r.saveToLocalStorageIfPossible)}function Ee(r,e){var t=r.__preset_select[r.__preset_select.selectedIndex];e?t.innerHTML=t.value+"*":t.innerHTML=t.value}function vn(r,e,t){if(t.__li=e,t.__gui=r,p.extend(t,{options:function(o){if(arguments.length>1){var a=t.__li.nextElementSibling;return t.remove(),se(r,t.object,t.property,{before:a,factoryArgs:[p.toArray(arguments)]})}if(p.isArray(o)||p.isObject(o)){var c=t.__li.nextElementSibling;return t.remove(),se(r,t.object,t.property,{before:c,factoryArgs:[o]})}},name:function(o){return t.__li.firstElementChild.firstElementChild.innerHTML=o,t},listen:function(){return t.__gui.listen(t),t},remove:function(){return t.__gui.remove(t),t}}),t instanceof fe){var s=new oe(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});p.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(i){var o=t[i],a=s[i];t[i]=s[i]=function(){var c=Array.prototype.slice.call(arguments);return a.apply(s,c),o.apply(t,c)}}),f.addClass(e,"has-slider"),t.domElement.insertBefore(s.domElement,t.domElement.firstElementChild)}else if(t instanceof oe){var n=function(o){if(p.isNumber(t.__min)&&p.isNumber(t.__max)){var a=t.__li.firstElementChild.firstElementChild.innerHTML,c=t.__gui.__listening.indexOf(t)>-1;t.remove();var l=se(r,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]});return l.name(a),c&&l.listen(),l}return o};t.min=p.compose(n,t.min),t.max=p.compose(n,t.max)}else t instanceof ke?(f.bind(e,"click",function(){f.fakeEvent(t.__checkbox,"click")}),f.bind(t.__checkbox,"click",function(i){i.stopPropagation()})):t instanceof Me?(f.bind(e,"click",function(){f.fakeEvent(t.__button,"click")}),f.bind(e,"mouseover",function(){f.addClass(t.__button,"hover")}),f.bind(e,"mouseout",function(){f.removeClass(t.__button,"hover")})):t instanceof he&&(f.addClass(e,"color"),t.updateDisplay=p.compose(function(i){return e.style.borderLeftColor=t.__color.toString(),i},t.updateDisplay),t.updateDisplay());t.setValue=p.compose(function(i){return r.getRoot().__preset_select&&t.isModified()&&Ee(r.getRoot(),!0),i},t.setValue)}function _t(r,e){var t=r.getRoot(),s=t.__rememberedObjects.indexOf(e.object);if(s!==-1){var n=t.__rememberedObjectIndecesToControllers[s];if(n===void 0&&(n={},t.__rememberedObjectIndecesToControllers[s]=n),n[e.property]=e,t.load&&t.load.remembered){var i=t.load.remembered,o=void 0;if(i[r.preset])o=i[r.preset];else if(i[ae])o=i[ae];else return;if(o[s]&&o[s][e.property]!==void 0){var a=o[s][e.property];e.initialValue=a,e.setValue(a)}}}}function se(r,e,t,s){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var n=void 0;if(s.color)n=new he(e,t);else{var i=[e,t].concat(s.factoryArgs);n=_n.apply(r,i)}s.before instanceof U&&(s.before=s.before.__li),_t(r,n),f.addClass(n.domElement,"c");var o=document.createElement("span");f.addClass(o,"property-name"),o.innerHTML=n.property;var a=document.createElement("div");a.appendChild(o),a.appendChild(n.domElement);var c=Ie(r,a,s.before);return f.addClass(c,T.CLASS_CONTROLLER_ROW),n instanceof he?f.addClass(c,"color"):f.addClass(c,an(n.getValue())),vn(r,c,n),r.__controllers.push(n),n}function z(r,e){return document.location.href+"."+e}function we(r,e,t){var s=document.createElement("option");s.innerHTML=e,s.value=e,r.__preset_select.appendChild(s),t&&(r.__preset_select.selectedIndex=r.__preset_select.length-1)}function qe(r,e){e.style.display=r.useLocalStorage?"block":"none"}function yn(r){var e=r.__save_row=document.createElement("li");f.addClass(r.domElement,"has-save"),r.__ul.insertBefore(e,r.__ul.firstChild),f.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",f.addClass(t,"button gears");var s=document.createElement("span");s.innerHTML="Save",f.addClass(s,"button"),f.addClass(s,"save");var n=document.createElement("span");n.innerHTML="New",f.addClass(n,"button"),f.addClass(n,"save-as");var i=document.createElement("span");i.innerHTML="Revert",f.addClass(i,"button"),f.addClass(i,"revert");var o=r.__preset_select=document.createElement("select");if(r.load&&r.load.remembered?p.each(r.load.remembered,function(u,h){we(r,h,h===r.preset)}):we(r,ae,!1),f.bind(o,"change",function(){for(var u=0;u<r.__preset_select.length;u++)r.__preset_select[u].innerHTML=r.__preset_select[u].value;r.preset=this.value}),e.appendChild(o),e.appendChild(t),e.appendChild(s),e.appendChild(n),e.appendChild(i),ee){var a=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage"),l=document.getElementById("dg-save-locally");l.style.display="block",localStorage.getItem(z(r,"isLocal"))==="true"&&c.setAttribute("checked","checked"),qe(r,a),f.bind(c,"change",function(){r.useLocalStorage=!r.useLocalStorage,qe(r,a)})}var d=document.getElementById("dg-new-constructor");f.bind(d,"keydown",function(u){u.metaKey&&(u.which===67||u.keyCode===67)&&ne.hide()}),f.bind(t,"click",function(){d.innerHTML=JSON.stringify(r.getSaveObject(),void 0,2),ne.show(),d.focus(),d.select()}),f.bind(s,"click",function(){r.save()}),f.bind(n,"click",function(){var u=prompt("Enter a new preset name.");u&&r.saveAs(u)}),f.bind(i,"click",function(){r.revert()})}function xn(r){var e=void 0;r.__resize_handle=document.createElement("div"),p.extend(r.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function t(i){return i.preventDefault(),r.width+=e-i.clientX,r.onResize(),e=i.clientX,!1}function s(){f.removeClass(r.__closeButton,T.CLASS_DRAG),f.unbind(window,"mousemove",t),f.unbind(window,"mouseup",s)}function n(i){return i.preventDefault(),e=i.clientX,f.addClass(r.__closeButton,T.CLASS_DRAG),f.bind(window,"mousemove",t),f.bind(window,"mouseup",s),!1}f.bind(r.__resize_handle,"mousedown",n),f.bind(r.__closeButton,"mousedown",n),r.domElement.insertBefore(r.__resize_handle,r.domElement.firstElementChild)}function Se(r,e){r.domElement.style.width=e+"px",r.__save_row&&r.autoPlace&&(r.__save_row.style.width=e+"px"),r.__closeButton&&(r.__closeButton.style.width=e+"px")}function le(r,e){var t={};return p.each(r.__rememberedObjects,function(s,n){var i={},o=r.__rememberedObjectIndecesToControllers[n];p.each(o,function(a,c){i[c]=e?a.initialValue:a.getValue()}),t[n]=i}),t}function Tn(r){for(var e=0;e<r.__preset_select.length;e++)r.__preset_select[e].value===r.preset&&(r.__preset_select.selectedIndex=e)}function mt(r){r.length!==0&&gn.call(window,function(){mt(r)}),p.each(r,function(e){e.updateDisplay()})}var En={Color:w,math:re,interpret:de},wn={Controller:U,BooleanController:ke,OptionController:ft,StringController:ht,NumberController:Ne,NumberControllerBox:oe,NumberControllerSlider:fe,FunctionController:Me,ColorController:he},Sn={dom:f},Cn={GUI:T},Rn=T,ls={color:En,controllers:wn,dom:Sn,gui:Cn,GUI:Rn};function Qe(r,e){if(e===At)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),r;if(e===xe||e===nt){let t=r.getIndex();if(t===null){const o=[],a=r.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)o.push(c);r.setIndex(o),t=r.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r}const s=t.count-2,n=[];if(e===xe)for(let o=1;o<=s;o++)n.push(t.getX(0)),n.push(t.getX(o)),n.push(t.getX(o+1));else for(let o=0;o<s;o++)o%2===0?(n.push(t.getX(o)),n.push(t.getX(o+1)),n.push(t.getX(o+2))):(n.push(t.getX(o+2)),n.push(t.getX(o+1)),n.push(t.getX(o)));n.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=r.clone();return i.setIndex(n),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),r}class us extends vt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Mn(t)}),this.register(function(t){return new Vn(t)}),this.register(function(t){return new jn(t)}),this.register(function(t){return new Kn(t)}),this.register(function(t){return new Fn(t)}),this.register(function(t){return new Dn(t)}),this.register(function(t){return new Hn(t)}),this.register(function(t){return new Pn(t)}),this.register(function(t){return new Nn(t)}),this.register(function(t){return new Bn(t)}),this.register(function(t){return new In(t)}),this.register(function(t){return new Un(t)}),this.register(function(t){return new Gn(t)}),this.register(function(t){return new On(t)}),this.register(function(t){return new zn(t)}),this.register(function(t){return new Xn(t)})}load(e,t,s,n){const i=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const l=te.extractUrlBase(e);o=te.resolveURL(l,this.path)}else o=te.extractUrlBase(e);this.manager.itemStart(e);const a=function(l){n?n(l):console.error(l),i.manager.itemError(e),i.manager.itemEnd(e)},c=new st(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{i.parse(l,o,function(d){t(d),i.manager.itemEnd(e)},a)}catch(d){a(d)}},s,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let i;const o={},a={},c=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===gt){try{o[v.KHR_BINARY_GLTF]=new $n(e)}catch(u){n&&n(u);return}i=JSON.parse(o[v.KHR_BINARY_GLTF].content)}else i=JSON.parse(c.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new os(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const u=this.pluginCallbacks[d](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(i.extensionsUsed)for(let d=0;d<i.extensionsUsed.length;++d){const u=i.extensionsUsed[d],h=i.extensionsRequired||[];switch(u){case v.KHR_MATERIALS_UNLIT:o[u]=new kn;break;case v.KHR_DRACO_MESH_COMPRESSION:o[u]=new Wn(i,this.dracoLoader);break;case v.KHR_TEXTURE_TRANSFORM:o[u]=new Yn;break;case v.KHR_MESH_QUANTIZATION:o[u]=new qn;break;default:h.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(s,n)}parseAsync(e,t){const s=this;return new Promise(function(n,i){s.parse(e,t,n,i)})}}function Ln(){let r={};return{get:function(e){return r[e]},add:function(e,t){r[e]=t},remove:function(e){delete r[e]},removeAll:function(){r={}}}}const v={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class On{constructor(e){this.parser=e,this.name=v.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const i=t[s];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const i=t.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let l;const d=new j(16777215);c.color!==void 0&&d.setRGB(c.color[0],c.color[1],c.color[2],N);const u=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new Tt(d),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new xt(d),l.distance=u;break;case"spot":l=new yt(d),l.distance=u,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,H(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),n=Promise.resolve(l),t.cache.add(s,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,i=s.json.nodes[e],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return s._getNodeRef(t.cache,a,c)})}}class kn{constructor(){this.name=v.KHR_MATERIALS_UNLIT}getMaterialType(){return Z}extendParams(e,t,s){const n=[];e.color=new j(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],N),e.opacity=o[3]}i.baseColorTexture!==void 0&&n.push(s.assignTexture(e,"map",i.baseColorTexture,ie))}return Promise.all(n)}}class Nn{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class Mn{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:M}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(s.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new it(a,a)}return Promise.all(i)}}class In{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:M}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}class Fn{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:M}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new j(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],N)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(s.assignTexture(t,"sheenColorMap",o.sheenColorTexture,ie)),o.sheenRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class Dn{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:M}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(s.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class Hn{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:M}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(s.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new j().setRGB(a[0],a[1],a[2],N),Promise.all(i)}}class Pn{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:M}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class Bn{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:M}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(s.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new j().setRGB(a[0],a[1],a[2],N),o.specularColorTexture!==void 0&&i.push(s.assignTexture(t,"specularColorMap",o.specularColorTexture,ie)),Promise.all(i)}}class Gn{constructor(e){this.parser=e,this.name=v.EXT_MATERIALS_BUMP}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:M}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&i.push(s.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(i)}}class Un{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:M}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&i.push(s.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(i)}}class Vn{constructor(e){this.parser=e,this.name=v.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,o)}}class jn{constructor(e){this.parser=e,this.name=v.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],a=n.images[o.source];let c=s.textureLoader;if(a.uri){const l=s.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return s.loadTextureImage(e,o.source,c);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Kn{constructor(e){this.parser=e,this.name=v.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],a=n.images[o.source];let c=s.textureLoader;if(a.uri){const l=s.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return s.loadTextureImage(e,o.source,c);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class zn{constructor(e){this.name=v.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const n=s.extensions[this.name],i=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(a){const c=n.byteOffset||0,l=n.byteLength||0,d=n.count,u=n.byteStride,h=new Uint8Array(a,c,l);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(d,u,h,n.mode,n.filter).then(function(_){return _.buffer}):o.ready.then(function(){const _=new ArrayBuffer(d*u);return o.decodeGltfBuffer(new Uint8Array(_),d,u,h,n.mode,n.filter),_})})}else return null}}class Xn{constructor(e){this.name=v.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const n=t.meshes[s.mesh];for(const l of n.primitives)if(l.mode!==C.TRIANGLES&&l.mode!==C.TRIANGLE_STRIP&&l.mode!==C.TRIANGLE_FAN&&l.mode!==void 0)return null;const o=s.extensions[this.name].attributes,a=[],c={};for(const l in o)a.push(this.parser.getDependency("accessor",o[l]).then(d=>(c[l]=d,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(l=>{const d=l.pop(),u=d.isGroup?d.children:[d],h=l[0].count,_=[];for(const g of u){const m=new ue,b=new X,A=new ut,x=new X(1,1,1),E=new Et(g.geometry,g.material,h);for(let y=0;y<h;y++)c.TRANSLATION&&b.fromBufferAttribute(c.TRANSLATION,y),c.ROTATION&&A.fromBufferAttribute(c.ROTATION,y),c.SCALE&&x.fromBufferAttribute(c.SCALE,y),E.setMatrixAt(y,m.compose(b,A,x));for(const y in c)if(y==="_COLOR_0"){const S=c[y];E.instanceColor=new wt(S.array,S.itemSize,S.normalized)}else y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&g.geometry.setAttribute(y,c[y]);rt.prototype.copy.call(E,g),this.parser.assignFinalMaterial(E),_.push(E)}return d.isGroup?(d.clear(),d.add(..._),d):_[0]}))}}const gt="glTF",J=12,Je={JSON:1313821514,BIN:5130562};class $n{constructor(e){this.name=v.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,J),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==gt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-J,i=new DataView(e,J);let o=0;for(;o<n;){const a=i.getUint32(o,!0);o+=4;const c=i.getUint32(o,!0);if(o+=4,c===Je.JSON){const l=new Uint8Array(e,J+o,a);this.content=s.decode(l)}else if(c===Je.BIN){const l=J+o;this.body=e.slice(l,l+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Wn{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=v.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},c={},l={};for(const d in o){const u=Ce[d]||d.toLowerCase();a[u]=o[d]}for(const d in e.attributes){const u=Ce[d]||d.toLowerCase();if(o[d]!==void 0){const h=s.accessors[e.attributes[d]],_=W[h.componentType];l[u]=_.name,c[u]=h.normalized===!0}}return t.getDependency("bufferView",i).then(function(d){return new Promise(function(u,h){n.decodeDracoFile(d,function(_){for(const g in _.attributes){const m=_.attributes[g],b=c[g];b!==void 0&&(m.normalized=b)}u(_)},a,l,N,h)})})}}class Yn{constructor(){this.name=v.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class qn{constructor(){this.name=v.KHR_MESH_QUANTIZATION}}class bt extends sn{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,i=e*n*3+n;for(let o=0;o!==n;o++)t[o]=s[i+o];return t}interpolate_(e,t,s,n){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=a*2,l=a*3,d=n-t,u=(s-t)/d,h=u*u,_=h*u,g=e*l,m=g-l,b=-2*_+3*h,A=_-h,x=1-b,E=A-h+u;for(let y=0;y!==a;y++){const S=o[m+y+a],I=o[m+y+c]*d,R=o[g+y+a],Y=o[g+y]*d;i[y]=x*S+E*I+b*R+A*Y}return i}}const Qn=new ut;class Jn extends bt{interpolate_(e,t,s,n){const i=super.interpolate_(e,t,s,n);return Qn.fromArray(i).normalize().toArray(i),i}}const C={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},W={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ze={9728:Xt,9729:ot,9984:$t,9985:Wt,9986:Yt,9987:at},et={33071:qt,33648:Qt,10497:Te},Ae={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ce={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},D={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Zn={CUBICSPLINE:void 0,LINEAR:lt,STEP:Jt},ve={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function es(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new ct({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Zt})),r.DefaultMaterial}function V(r,e,t){for(const s in t.extensions)r[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function H(r,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(r.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ts(r,e,t){let s=!1,n=!1,i=!1;for(let l=0,d=e.length;l<d;l++){const u=e[l];if(u.POSITION!==void 0&&(s=!0),u.NORMAL!==void 0&&(n=!0),u.COLOR_0!==void 0&&(i=!0),s&&n&&i)break}if(!s&&!n&&!i)return Promise.resolve(r);const o=[],a=[],c=[];for(let l=0,d=e.length;l<d;l++){const u=e[l];if(s){const h=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):r.attributes.position;o.push(h)}if(n){const h=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):r.attributes.normal;a.push(h)}if(i){const h=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):r.attributes.color;c.push(h)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const d=l[0],u=l[1],h=l[2];return s&&(r.morphAttributes.position=d),n&&(r.morphAttributes.normal=u),i&&(r.morphAttributes.color=h),r.morphTargetsRelative=!0,r})}function ns(r,e){if(r.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)r.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(r.morphTargetInfluences.length===t.length){r.morphTargetDictionary={};for(let s=0,n=t.length;s<n;s++)r.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ss(r){let e;const t=r.extensions&&r.extensions[v.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+ye(t.attributes):e=r.indices+":"+ye(r.attributes)+":"+r.mode,r.targets!==void 0)for(let s=0,n=r.targets.length;s<n;s++)e+=":"+ye(r.targets[s]);return e}function ye(r){let e="";const t=Object.keys(r).sort();for(let s=0,n=t.length;s<n;s++)e+=t[s]+":"+r[t[s]]+";";return e}function Re(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function is(r){return r.search(/\.jpe?g($|\?)/i)>0||r.search(/^data\:image\/jpeg/)===0?"image/jpeg":r.search(/\.webp($|\?)/i)>0||r.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const rs=new ue;class os{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Ln,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,n=!1,i=-1;typeof navigator<"u"&&(s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,i=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||s||n&&i<98?this.textureLoader=new St(this.options.manager):this.textureLoader=new Ct(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new st(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(o){const a={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:s,userData:{}};return V(i,a,n),H(a,n),Promise.all(s._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){for(const c of a.scenes)c.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const o=t[n].joints;for(let a=0,c=o.length;a<c;a++)e[o[a]].isBone=!0}for(let n=0,i=e.length;n<i;n++){const o=e[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(s[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),i=(o,a)=>{const c=this.associations.get(o);c!=null&&this.associations.set(a,c);for(const[l,d]of o.children.entries())i(d,a.children[l])};return i(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i&&s.push(i)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(i){return i.loadNode&&i.loadNode(t)});break;case"mesh":n=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(i,o){return s.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[v.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(i,o){s.load(te.resolveURL(t.uri,n.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const n=t.byteLength||0,i=t.byteOffset||0;return s.slice(i,i+n)})}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const o=Ae[n.type],a=W[n.componentType],c=n.normalized===!0,l=new a(n.count*o);return Promise.resolve(new _e(l,o,c))}const i=[];return n.bufferView!==void 0?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),n.sparse!==void 0&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(o){const a=o[0],c=Ae[n.type],l=W[n.componentType],d=l.BYTES_PER_ELEMENT,u=d*c,h=n.byteOffset||0,_=n.bufferView!==void 0?s.bufferViews[n.bufferView].byteStride:void 0,g=n.normalized===!0;let m,b;if(_&&_!==u){const A=Math.floor(h/_),x="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+A+":"+n.count;let E=t.cache.get(x);E||(m=new l(a,A*_,n.count*_/d),E=new Rt(m,_/d),t.cache.add(x,E)),b=new en(E,c,h%_/d,g)}else a===null?m=new l(n.count*c):m=new l(a,h,n.count*c),b=new _e(m,c,g);if(n.sparse!==void 0){const A=Ae.SCALAR,x=W[n.sparse.indices.componentType],E=n.sparse.indices.byteOffset||0,y=n.sparse.values.byteOffset||0,S=new x(o[1],E,n.sparse.count*A),I=new l(o[2],y,n.sparse.count*c);a!==null&&(b=new _e(b.array.slice(),b.itemSize,b.normalized));for(let R=0,Y=S.length;R<Y;R++){const F=S[R];if(b.setX(F,I[R*c]),c>=2&&b.setY(F,I[R*c+1]),c>=3&&b.setZ(F,I[R*c+2]),c>=4&&b.setW(F,I[R*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(e){const t=this.json,s=this.options,i=t.textures[e].source,o=t.images[i];let a=this.textureLoader;if(o.uri){const c=s.manager.getHandler(o.uri);c!==null&&(a=c)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,s){const n=this,i=this.json,o=i.textures[e],a=i.images[t],c=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,s).then(function(d){d.flipY=!1,d.name=o.name||a.name||"",d.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(d.name=a.uri);const h=(i.samplers||{})[o.sampler]||{};return d.magFilter=Ze[h.magFilter]||ot,d.minFilter=Ze[h.minFilter]||at,d.wrapS=et[h.wrapS]||Te,d.wrapT=et[h.wrapT]||Te,n.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const s=this,n=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const o=n.images[e],a=self.URL||self.webkitURL;let c=o.uri||"",l=!1;if(o.bufferView!==void 0)c=s.getDependency("bufferView",o.bufferView).then(function(u){l=!0;const h=new Blob([u],{type:o.mimeType});return c=a.createObjectURL(h),c});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(c).then(function(u){return new Promise(function(h,_){let g=h;t.isImageBitmapLoader===!0&&(g=function(m){const b=new De(m);b.needsUpdate=!0,h(b)}),t.load(te.resolveURL(u,i.path),g,void 0,_)})}).then(function(u){return l===!0&&a.revokeObjectURL(c),u.userData.mimeType=o.mimeType||is(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[e]=d,d}assignTexture(e,t,s,n){const i=this;return this.getDependency("texture",s.index).then(function(o){if(!o)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(o=o.clone(),o.channel=s.texCoord),i.extensions[v.KHR_TEXTURE_TRANSFORM]){const a=s.extensions!==void 0?s.extensions[v.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=i.associations.get(o);o=i.extensions[v.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),i.associations.set(o,c)}}return n!==void 0&&(o.colorSpace=n),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+s.uuid;let c=this.cache.get(a);c||(c=new Lt,me.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,c.sizeAttenuation=!1,this.cache.add(a,c)),s=c}else if(e.isLine){const a="LineBasicMaterial:"+s.uuid;let c=this.cache.get(a);c||(c=new Ot,me.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,this.cache.add(a,c)),s=c}if(n||i||o){let a="ClonedMaterial:"+s.uuid+":";n&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=s.clone(),i&&(c.vertexColors=!0),o&&(c.flatShading=!0),n&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(s))),s=c}e.material=s}getMaterialType(){return ct}loadMaterial(e){const t=this,s=this.json,n=this.extensions,i=s.materials[e];let o;const a={},c=i.extensions||{},l=[];if(c[v.KHR_MATERIALS_UNLIT]){const u=n[v.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),l.push(u.extendParams(a,i,t))}else{const u=i.pbrMetallicRoughness||{};if(a.color=new j(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const h=u.baseColorFactor;a.color.setRGB(h[0],h[1],h[2],N),a.opacity=h[3]}u.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",u.baseColorTexture,ie)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,a)})))}i.doubleSided===!0&&(a.side=kt);const d=i.alphaMode||ve.OPAQUE;if(d===ve.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,d===ve.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==Z&&(l.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new it(1,1),i.normalTexture.scale!==void 0)){const u=i.normalTexture.scale;a.normalScale.set(u,u)}if(i.occlusionTexture!==void 0&&o!==Z&&(l.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==Z){const u=i.emissiveFactor;a.emissive=new j().setRGB(u[0],u[1],u[2],N)}return i.emissiveTexture!==void 0&&o!==Z&&l.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,ie)),Promise.all(l).then(function(){const u=new o(a);return i.name&&(u.name=i.name),H(u,i),t.associations.set(u,{materials:e}),i.extensions&&V(n,u,i),u})}createUniqueName(e){const t=Nt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function i(a){return s[v.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return tt(c,a,t)})}const o=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],d=ss(l),u=n[d];if(u)o.push(u.promise);else{let h;l.extensions&&l.extensions[v.KHR_DRACO_MESH_COMPRESSION]?h=i(l):h=tt(new Mt,l,t),n[d]={primitive:l,promise:h},o.push(h)}}return Promise.all(o)}loadMesh(e){const t=this,s=this.json,n=this.extensions,i=s.meshes[e],o=i.primitives,a=[];for(let c=0,l=o.length;c<l;c++){const d=o[c].material===void 0?es(this.cache):this.getDependency("material",o[c].material);a.push(d)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),d=c[c.length-1],u=[];for(let _=0,g=d.length;_<g;_++){const m=d[_],b=o[_];let A;const x=l[_];if(b.mode===C.TRIANGLES||b.mode===C.TRIANGLE_STRIP||b.mode===C.TRIANGLE_FAN||b.mode===void 0)A=i.isSkinnedMesh===!0?new It(m,x):new Ft(m,x),A.isSkinnedMesh===!0&&A.normalizeSkinWeights(),b.mode===C.TRIANGLE_STRIP?A.geometry=Qe(A.geometry,nt):b.mode===C.TRIANGLE_FAN&&(A.geometry=Qe(A.geometry,xe));else if(b.mode===C.LINES)A=new Dt(m,x);else if(b.mode===C.LINE_STRIP)A=new Ht(m,x);else if(b.mode===C.LINE_LOOP)A=new Pt(m,x);else if(b.mode===C.POINTS)A=new Bt(m,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(A.geometry.morphAttributes).length>0&&ns(A,i),A.name=t.createUniqueName(i.name||"mesh_"+e),H(A,i),b.extensions&&V(n,A,b),t.assignFinalMaterial(A),u.push(A)}for(let _=0,g=u.length;_<g;_++)t.associations.set(u[_],{meshes:e,primitives:_});if(u.length===1)return i.extensions&&V(n,u[0],i),u[0];const h=new ge;i.extensions&&V(n,h,i),t.associations.set(h,{meshes:e});for(let _=0,g=u.length;_<g;_++)h.add(u[_]);return h})}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new Gt(Ut.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):s.type==="orthographic"&&(t=new Vt(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),H(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s=[];for(let n=0,i=t.joints.length;n<i;n++)s.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(n){const i=n.pop(),o=n,a=[],c=[];for(let l=0,d=o.length;l<d;l++){const u=o[l];if(u){a.push(u);const h=new ue;i!==null&&h.fromArray(i.array,l*16),c.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new jt(a,c)})}loadAnimation(e){const t=this.json,s=this,n=t.animations[e],i=n.name?n.name:"animation_"+e,o=[],a=[],c=[],l=[],d=[];for(let u=0,h=n.channels.length;u<h;u++){const _=n.channels[u],g=n.samplers[_.sampler],m=_.target,b=m.node,A=n.parameters!==void 0?n.parameters[g.input]:g.input,x=n.parameters!==void 0?n.parameters[g.output]:g.output;m.node!==void 0&&(o.push(this.getDependency("node",b)),a.push(this.getDependency("accessor",A)),c.push(this.getDependency("accessor",x)),l.push(g),d.push(m))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(d)]).then(function(u){const h=u[0],_=u[1],g=u[2],m=u[3],b=u[4],A=[];for(let x=0,E=h.length;x<E;x++){const y=h[x],S=_[x],I=g[x],R=m[x],Y=b[x];if(y===void 0)continue;y.updateMatrix&&y.updateMatrix();const F=s._createAnimationTracks(y,S,I,R,Y);if(F)for(let pe=0;pe<F.length;pe++)A.push(F[pe])}return new Kt(i,void 0,A)})}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return n.mesh===void 0?null:s.getDependency("mesh",n.mesh).then(function(i){const o=s._getNodeRef(s.meshCache,n.mesh,i);return n.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let c=0,l=n.weights.length;c<l;c++)a.morphTargetInfluences[c]=n.weights[c]}),o})}loadNode(e){const t=this.json,s=this,n=t.nodes[e],i=s._loadNodeShallow(e),o=[],a=n.children||[];for(let l=0,d=a.length;l<d;l++)o.push(s.getDependency("node",a[l]));const c=n.skin===void 0?Promise.resolve(null):s.getDependency("skin",n.skin);return Promise.all([i,Promise.all(o),c]).then(function(l){const d=l[0],u=l[1],h=l[2];h!==null&&d.traverse(function(_){_.isSkinnedMesh&&_.bind(h,rs)});for(let _=0,g=u.length;_<g;_++)d.add(u[_]);return d})}_loadNodeShallow(e){const t=this.json,s=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=t.nodes[e],o=i.name?n.createUniqueName(i.name):"",a=[],c=n._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),i.camera!==void 0&&a.push(n.getDependency("camera",i.camera).then(function(l){return n._getNodeRef(n.cameraCache,i.camera,l)})),n._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),this.nodeCache[e]=Promise.all(a).then(function(l){let d;if(i.isBone===!0?d=new zt:l.length>1?d=new ge:l.length===1?d=l[0]:d=new rt,d!==l[0])for(let u=0,h=l.length;u<h;u++)d.add(l[u]);if(i.name&&(d.userData.name=i.name,d.name=o),H(d,i),i.extensions&&V(s,d,i),i.matrix!==void 0){const u=new ue;u.fromArray(i.matrix),d.applyMatrix4(u)}else i.translation!==void 0&&d.position.fromArray(i.translation),i.rotation!==void 0&&d.quaternion.fromArray(i.rotation),i.scale!==void 0&&d.scale.fromArray(i.scale);return n.associations.has(d)||n.associations.set(d,{}),n.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],n=this,i=new ge;s.name&&(i.name=n.createUniqueName(s.name)),H(i,s),s.extensions&&V(t,i,s);const o=s.nodes||[],a=[];for(let c=0,l=o.length;c<l;c++)a.push(n.getDependency("node",o[c]));return Promise.all(a).then(function(c){for(let d=0,u=c.length;d<u;d++)i.add(c[d]);const l=d=>{const u=new Map;for(const[h,_]of n.associations)(h instanceof me||h instanceof De)&&u.set(h,_);return d.traverse(h=>{const _=n.associations.get(h);_!=null&&u.set(h,_)}),u};return n.associations=l(i),i})}_createAnimationTracks(e,t,s,n,i){const o=[],a=e.name?e.name:e.uuid,c=[];D[i.path]===D.weights?e.traverse(function(h){h.morphTargetInfluences&&c.push(h.name?h.name:h.uuid)}):c.push(a);let l;switch(D[i.path]){case D.weights:l=Pe;break;case D.rotation:l=Be;break;case D.position:case D.scale:l=He;break;default:switch(s.itemSize){case 1:l=Pe;break;case 2:case 3:default:l=He;break}break}const d=n.interpolation!==void 0?Zn[n.interpolation]:lt,u=this._getArrayFromAccessor(s);for(let h=0,_=c.length;h<_;h++){const g=new l(c[h]+"."+D[i.path],t.array,u,d);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),o.push(g)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const s=Re(t.constructor),n=new Float32Array(t.length);for(let i=0,o=t.length;i<o;i++)n[i]=t[i]*s;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(s){const n=this instanceof Be?Jn:bt;return new n(this.times,this.values,this.getValueSize()/3,s)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function as(r,e,t){const s=e.attributes,n=new tn;if(s.POSITION!==void 0){const a=t.json.accessors[s.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(n.set(new X(c[0],c[1],c[2]),new X(l[0],l[1],l[2])),a.normalized){const d=Re(W[a.componentType]);n.min.multiplyScalar(d),n.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const a=new X,c=new X;for(let l=0,d=i.length;l<d;l++){const u=i[l];if(u.POSITION!==void 0){const h=t.json.accessors[u.POSITION],_=h.min,g=h.max;if(_!==void 0&&g!==void 0){if(c.setX(Math.max(Math.abs(_[0]),Math.abs(g[0]))),c.setY(Math.max(Math.abs(_[1]),Math.abs(g[1]))),c.setZ(Math.max(Math.abs(_[2]),Math.abs(g[2]))),h.normalized){const m=Re(W[h.componentType]);c.multiplyScalar(m)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}r.boundingBox=n;const o=new nn;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,r.boundingSphere=o}function tt(r,e,t){const s=e.attributes,n=[];function i(o,a){return t.getDependency("accessor",o).then(function(c){r.setAttribute(a,c)})}for(const o in s){const a=Ce[o]||o.toLowerCase();a in r.attributes||n.push(i(s[o],a))}if(e.indices!==void 0&&!r.index){const o=t.getDependency("accessor",e.indices).then(function(a){r.setIndex(a)});n.push(o)}return Fe.workingColorSpace!==N&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Fe.workingColorSpace}" not supported.`),H(r,e),as(r,e,t),Promise.all(n).then(function(){return e.targets!==void 0?ts(r,e.targets,t):r})}export{us as G,ls as i};
